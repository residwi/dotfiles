#!/usr/bin/env bash
# Apply system-level configs that require sudo

set -euo pipefail

DOTFILES_DIR="${DOTFILES_DIR:-$HOME/dotfiles}"

echo "Applying system configurations..."

# Systemd system configs
if [[ -d "$DOTFILES_DIR/config/arch/systemd/system.conf.d" ]]; then
  sudo mkdir -p /etc/systemd/system.conf.d
  for conf in "$DOTFILES_DIR/config/arch/systemd/system.conf.d"/*; do
    [[ -f "$conf" ]] || continue
    sudo cp "$conf" "/etc/systemd/system.conf.d/$(basename "$conf")"
  done
  echo "Applied systemd system configs"
fi

# Modprobe configs
if [[ -d "$DOTFILES_DIR/config/arch/modprobe.d" ]]; then
  sudo mkdir -p /etc/modprobe.d
  for conf in "$DOTFILES_DIR/config/arch/modprobe.d"/*; do
    [[ -f "$conf" ]] || continue
    sudo cp "$conf" "/etc/modprobe.d/$(basename "$conf")"
  done
  echo "Applied modprobe configs"
fi

sudo systemctl daemon-reload

echo "System configurations applied!"
