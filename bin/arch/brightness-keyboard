#!/usr/bin/env bash
# Keyboard backlight control

set -euo pipefail

direction="${1:-up}"

# Find keyboard backlight device
device=""
for candidate in /sys/class/leds/*kbd_backlight*; do
  if [[ -e "$candidate" ]]; then
    device="$(basename "$candidate")"
    break
  fi
done

[[ -z "$device" ]] && { echo "No keyboard backlight found" >&2; exit 1; }

max_brightness="$(brightnessctl -d "$device" max)"
current_brightness="$(brightnessctl -d "$device" get)"

if [[ "$direction" == "up" ]]; then
  new_brightness=$((current_brightness + 1))
  [[ $new_brightness -gt $max_brightness ]] && new_brightness=$max_brightness
else
  new_brightness=$((current_brightness - 1))
  [[ $new_brightness -lt 0 ]] && new_brightness=0
fi

brightnessctl -d "$device" set "$new_brightness" >/dev/null

percent=$((new_brightness * 100 / max_brightness))
~/.local/bin/swayosd-brightness "$percent"
