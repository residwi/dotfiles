#!/usr/bin/env bash
# Screenshot utility using hyprshot and satty

set -euo pipefail

MODE="${1:-screen}"
SCREENSHOT_DIR="${HOME}/Pictures/Screenshots"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
FILENAME="${SCREENSHOT_DIR}/screenshot_${TIMESTAMP}.png"

mkdir -p "$SCREENSHOT_DIR"

case "$MODE" in
    screen)
        grim "$FILENAME"
        ;;
    region)
        grim -g "$(slurp)" "$FILENAME"
        ;;
    window)
        grim -g "$(hyprctl activewindow -j | jq -r '"\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"')" "$FILENAME"
        ;;
    *)
        echo "Usage: screenshot [screen|region|window]"
        exit 1
        ;;
esac

# Open in satty for annotation
if command -v satty &> /dev/null; then
    satty --filename "$FILENAME" --output-filename "$FILENAME"
fi

# Copy to clipboard
wl-copy < "$FILENAME"

notify-send "Screenshot" "Saved to $FILENAME" -i "$FILENAME"
