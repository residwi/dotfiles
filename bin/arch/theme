#!/usr/bin/env bash
# Theme switcher utility

set -euo pipefail

THEMES_DIR="${HOME}/dotfiles/config/arch/themes"
CURRENT_LINK="${HOME}/.config/theme/current"

list_themes() {
    echo "Available themes:"
    for theme in "$THEMES_DIR"/*/; do
        theme_name=$(basename "$theme")
        if [ "$(readlink -f "$CURRENT_LINK")" = "$(realpath "$theme")" ]; then
            echo "  * $theme_name (current)"
        else
            echo "    $theme_name"
        fi
    done
}

set_theme() {
    local theme="$1"
    local theme_path="${THEMES_DIR}/${theme}"
    
    if [ ! -d "$theme_path" ]; then
        echo "Error: Theme '$theme' not found"
        list_themes
        exit 1
    fi
    
    mkdir -p "$(dirname "$CURRENT_LINK")"
    ln -sfn "$theme_path" "$CURRENT_LINK"
    
    # Copy wallpaper if exists
    if [ -f "${theme_path}/wallpapers/default.jpg" ]; then
        ln -sf "${theme_path}/wallpapers/default.jpg" "${CURRENT_LINK}/wallpaper.jpg"
    fi
    
    echo "Theme set to: $theme"
    echo "Reload Hyprland to apply: hyprctl reload"
}

case "${1:-list}" in
    list) list_themes ;;
    set)
        if [ -z "${2:-}" ]; then
            echo "Usage: theme set <theme-name>"
            exit 1
        fi
        set_theme "$2"
        ;;
    *)
        echo "Usage: theme [list|set <theme-name>]"
        exit 1
        ;;
esac
