#!/usr/bin/env bash
# Smart display brightness with SwayOSD

set -euo pipefail

step="${1:-+5%}"

# Find the best backlight device
device="$(ls -1 /sys/class/backlight 2>/dev/null | head -n1)"
for candidate in amdgpu_bl* intel_backlight acpi_video*; do
  if [[ -e "/sys/class/backlight/$candidate" ]]; then
    device="$candidate"
    break
  fi
done

[[ -z "$device" ]] && { echo "No backlight device found" >&2; exit 1; }

# Set brightness
brightnessctl -d "$device" set "$step" >/dev/null

# Show with SwayOSD
~/.local/bin/swayosd-brightness "$(brightnessctl -d "$device" -m | cut -d',' -f4 | tr -d '%')"
